<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Meteo personnelle</title>
  <style>
    :root{
      --bg:#0b0f14; --fg:#e6e8eb; --muted:#9aa4af; --card:#121821; --accent:#4ea1ff;
      --blue:#3b82f6; --yellow:#facc15; --orange:#fb923c; --green:#10b981; --red:#ef4444;
      --shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    [data-theme="light"]{ --bg:#f6f7f9; --fg:#0e1116; --muted:#586173; --card:#ffffff; --accent:#0b74ff; --shadow: 0 8px 20px rgba(0,0,0,.08);}    
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji"}
    a{color:var(--accent);text-decoration:none}
    .wrap{max-width:1100px;margin:0 auto;padding:24px}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:18px}
    .title{font-size:22px;font-weight:700;letter-spacing:.2px}
    .subtitle{font-size:13px;color:var(--muted)}
    .row{display:grid;grid-template-columns:1.5fr 1fr;gap:16px}
    @media (max-width:900px){.row{grid-template-columns:1fr}}
    .card{background:var(--card);border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:16px;box-shadow:var(--shadow)}
    .controls{display:flex;gap:10px;flex-wrap:wrap}
    button,.btn{background:transparent;border:1px solid rgba(255,255,255,.18);color:var(--fg);padding:8px 12px;border-radius:12px;cursor:pointer}
    button:hover,.btn:hover{border-color:var(--accent)}
    .grid{display:grid;grid-template-columns:repeat(5,1fr);gap:10px}
    @media (max-width:700px){.grid{grid-template-columns:repeat(2,1fr)}}
    .current{display:grid;grid-template-columns:auto 1fr;gap:14px;align-items:center}
    .current .temp{font-size:48px;font-weight:800}
    .kpi{display:flex;gap:14px;flex-wrap:wrap;margin-top:6px}
    .kpi span{font-size:13px;color:var(--muted)}
    .pill{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.12);font-size:13px}
    .scrollx{display:flex;gap:10px;overflow:auto;padding-bottom:6px}
    .hour{min-width:84px;padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,.1);text-align:center}
    .muted{color:var(--muted)}
    .temp-blue{color:var(--blue)} .temp-yellow{color:var(--yellow)} .temp-orange{color:var(--orange)}
    .footer{margin-top:18px;font-size:12px;color:var(--muted)}
    .spacer{flex:1}
  </style>
</head>
<body data-theme="dark">
  <div class="wrap">
    <header>
      <div>
        <div class="title">Meteo personnelle</div>
        <div class="subtitle" id="locationLabel">Luxembourg • en cours de chargement...</div>
      </div>
      <div class="controls">
        <button id="themeBtn" title="Basculer clair/sombre">Theme</button>
        <button id="gpsBtn" title="Utiliser la geolocalisation">GPS</button>
        <button id="refreshBtn" title="Rafraichir">Refresh</button>
      </div>
    </header>

    <div class="row">
      <section class="card" id="currentCard">
        <div class="current">
          <img id="currentIcon" alt="icon" width="84" height="84" src="" />
          <div>
            <div class="temp" id="currentTemp">--°C</div>
            <div class="muted" id="currentDesc">--</div>
            <div class="kpi">
              <span class="pill" id="feelsLike">Ressenti --°C</span>
              <span class="pill" id="wind">Vent -- km/h</span>
              <span class="pill" id="humidity">Humidite --%</span>
              <span class="pill" id="uv">UV --</span>
            </div>
          </div>
        </div>
        <div class="footer" id="updatedAt">Maj --:--</div>
      </section>

      <section class="card">
        <h3 style="margin:0 0 10px 0">Previsions 5 jours</h3>
        <div class="grid" id="dailyGrid"></div>
      </section>
    </div>

    <section class="card" style="margin-top:16px">
      <h3 style="margin:0 0 10px 0">Heure par heure (prochaines 12h)</h3>
      <div class="scrollx" id="hourlyStrip"></div>
    </section>

    <div class="footer">Donnees: OpenWeatherMap • icones OWM. Cette page est statique, aucun backend. </div>
  </div>

  <script>
    // ---------- CONFIG ----------
    // Remplacer par ta cle API (One Call 3.0). Ne pas commiter publiquement si tu veux la garder privee.
    const API_KEY = "72ef18ba4bef82cde9151ad033b63980"; // <= remplace
    const DEFAULT_COORDS = { lat: 49.6116, lon: 6.1319, label: "Luxembourg" };
    const UNITS = "metric";
    const LANG = "fr"; // on retirera les accents a l affichage

    // ---------- UTILS ----------
    const $ = sel => document.querySelector(sel);
    const fmtTime = ts => new Date(ts * 1000).toLocaleTimeString(undefined, {hour: '2-digit', minute: '2-digit'});
    const fmtDay = ts => new Date(ts * 1000).toLocaleDateString(undefined, { weekday: 'short'});
    const fmtDate = ts => new Date(ts).toLocaleTimeString(undefined, {hour: '2-digit', minute: '2-digit'});
    const stripDiacritics = s => (s||"").normalize('NFD').replace(/[\u0300-\u036f]/g, '');
    function tempClass(t){
      if (t < 10) return 'temp-blue';
      if (t < 25) return 'temp-yellow';
      return 'temp-orange';
    }
    function kmh(ms){ return Math.round(ms * 3.6); }

    // ---------- THEME ----------
    const themeBtn = $('#themeBtn');
    function applyTheme(t){ document.body.setAttribute('data-theme', t); localStorage.setItem('theme', t); }
    themeBtn.addEventListener('click', ()=>{ const t = document.body.getAttribute('data-theme')==='dark'?'light':'dark'; applyTheme(t); });
    applyTheme(localStorage.getItem('theme')||'dark');

    // ---------- FETCH WEATHER ----------
    async function fetchWeather(lat, lon){
      const url = new URL('https://api.openweathermap.org/data/3.0/onecall');
      url.searchParams.set('lat', lat);
      url.searchParams.set('lon', lon);
      url.searchParams.set('units', UNITS);
      url.searchParams.set('lang', LANG);
      url.searchParams.set('appid', API_KEY);
      const r = await fetch(url);
      if(!r.ok) throw new Error('Echec API: ' + r.status);
      return r.json();
    }

    function iconUrl(code){ return `https://openweathermap.org/img/wn/${code}@2x.png`; }

    // ---------- RENDER ----------
    function renderCurrent(data){
      const c = data.current;
      const t = Math.round(c.temp);
      const desc = stripDiacritics(c.weather?.[0]?.description || '--');
      $('#currentIcon').src = iconUrl(c.weather?.[0]?.icon || '01d');
      $('#currentTemp').textContent = t + '°C';
      $('#currentTemp').className = 'temp ' + tempClass(t);
      $('#currentDesc').textContent = desc;
      $('#feelsLike').textContent = 'Ressenti ' + Math.round(c.feels_like) + '°C';
      $('#wind').textContent = 'Vent ' + kmh(c.wind_speed) + ' km/h';
      $('#humidity').textContent = 'Humidite ' + c.humidity + '%';
      $('#uv').textContent = 'UV ' + Math.round(c.uvi);
      $('#updatedAt').textContent = 'Maj ' + fmtDate(Date.now());
    }

    function renderHourly(data){
      const wrap = $('#hourlyStrip');
      wrap.innerHTML = '';
      data.hourly.slice(0,12).forEach(h=>{
        const t = Math.round(h.temp);
        const el = document.createElement('div');
        el.className = 'hour';
        el.innerHTML = `
          <div class="muted">${fmtTime(h.dt)}</div>
          <img src="${iconUrl(h.weather?.[0]?.icon||'01d')}" alt="" width="48" height="48" />
          <div class="${tempClass(t)}" style="font-weight:700">${t}°C</div>
        `;
        wrap.appendChild(el);
      });
    }

    function renderDaily(data){
      const grid = $('#dailyGrid');
      grid.innerHTML = '';
      data.daily.slice(1,6).forEach(d=>{
        const tmin = Math.round(d.temp.min), tmax = Math.round(d.temp.max);
        const el = document.createElement('div');
        el.className = 'hour';
        el.innerHTML = `
          <div class="muted" style="text-transform:capitalize">${stripDiacritics(fmtDay(d.dt))}</div>
          <img src="${iconUrl(d.weather?.[0]?.icon||'01d')}" alt="" width="48" height="48" />
          <div style="display:flex;justify-content:center;gap:6px">
            <span class="${tempClass(tmax)}" style="font-weight:700">${tmax}°</span>
            <span class="muted">${tmin}°</span>
          </div>
        `;
        grid.appendChild(el);
      });
    }

    function setLocationLabel(name){ $('#locationLabel').textContent = name; }

    async function load(coords){
      try{
        setLocationLabel((coords.label||'Localisation') + ' • chargement...');
        const data = await fetchWeather(coords.lat, coords.lon);
        renderCurrent(data); renderHourly(data); renderDaily(data);
        setLocationLabel((coords.label||'Position GPS'));
      }catch(e){
        console.error(e);
        alert('Impossible de charger la meteo. Verifie la cle API et la connexion.');
      }
    }

    // ---------- GEO ----------
    const gpsBtn = $('#gpsBtn');
    gpsBtn.addEventListener('click', ()=>{
      if(!('geolocation' in navigator)) return alert('GPS non disponible dans ce navigateur.');
      navigator.geolocation.getCurrentPosition(pos=>{
        const {latitude:lat, longitude:lon} = pos.coords;
        load({lat,lon,label:'GPS'});
      }, err=>{
        alert('GPS refuse: ' + err.message);
      });
    });

    $('#refreshBtn').addEventListener('click', ()=>{
      const label = $('#locationLabel').textContent.includes('GPS')?'GPS':DEFAULT_COORDS.label;
      load(label==='GPS'? { lat: lastCoords.lat, lon: lastCoords.lon, label: 'GPS' } : DEFAULT_COORDS);
    });

    let lastCoords = DEFAULT_COORDS;
    async function init(){
      if(API_KEY === 'A_METTRE_ICI'){ $('#locationLabel').textContent = 'Ajoute ta cle API dans le code puis recharge.'; return; }
      await load(DEFAULT_COORDS);
    }
    init();
  </script>
</body>
</html>
